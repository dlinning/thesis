"use strict";function setHost(){window.localStorage.setItem("type","host")}var MQTT_CLIENT_ID=null,IS_INPUT=!1;!function(){var e=!1;void 0!==Paho.MQTT?e=!0:console.error("Be sure to include https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js");var t=null,o=!1,n=document.getElementById("connMsg"),i=function(){e&&((t=new Paho.MQTT.Client("wss://mqtt.thesis.dougs.website/ws",1==IS_INPUT?"DEMO_"+Math.random():MQTT_CLIENT_ID)).onMessageArrived=a,t.connect({password:"AUTH_KEY",onSuccess:function(){console.log("CONNECTED"),t.subscribe("flowPub/"+MQTT_CLIENT_ID),o=!0,document.getElementById("connect-button").hidden=!0,n.innerText="Connected"}}))};window.mqttConnect=i;var a=function(e){console.log(e.destinationName+" : "+e.payloadString);var t=JSON.parse(e.payloadString);playDrum(t.play)},s=function(e,n){if(o){var i={value:e,dataType:n,timestamp:(new Date).getTime(),sensorId:MQTT_CLIENT_ID};t.send("log",JSON.stringify(i),1)}};window.logSensorData=s}();var setupHostView=function(){function e(e){var t=document.getElementById(e);if(t){var n=o[e];n.played||(n.played=!0,t.style.transitionDuration=n.audio.duration/3+"s"),n.audio.paused?n.audio.play():n.audio.currentTime=0,t.classList.add("play"),clearTimeout(n.timer),n.timer=setTimeout(function(){t.classList.remove("play")},1e3*n.audio.duration)}}var t=document.querySelectorAll(".drum");document.getElementById("host").style.display="block";var o={snare:{audio:new Audio("./sounds/snare.opus"),timer:null,played:!1},crash:{audio:new Audio("./sounds/crash.opus"),timer:null,played:!1},hihatO:{audio:new Audio("./sounds/hihatO.opus"),timer:null,played:!1},hihatC:{audio:new Audio("./sounds/hihatC.opus"),timer:null,played:!1},kick:{audio:new Audio("./sounds/kick.opus"),timer:null,played:!1},lowtom:{audio:new Audio("./sounds/lowtom.opus"),timer:null,played:!1},medtom:{audio:new Audio("./sounds/medtom.opus"),timer:null,played:!1},hitom:{audio:new Audio("./sounds/hitom.opus"),timer:null,played:!1}};t.forEach(function(t){t.addEventListener("click",function(o){o.preventDefault(),e(t.id)})}),window.playDrum=e},setupClientView=function(){document.getElementById("client").style.display="flex";var e=!0;IS_INPUT=!0,mqttConnect();var t=document.getElementById("client-select"),o=t.getElementsByTagName("option");t.selectedIndex=Math.floor(Math.random()*o.length);var n=document.getElementById("countdown"),i=document.getElementById("client-play");i.addEventListener("click",function(o){if(o.preventDefault(),e){var a=t.value;logSensorData(a,"string"),e=!1,n.classList.add("play"),i.disabled=!0,setTimeout(function(){e=!0,i.disabled=!1},750),setTimeout(function(){n.classList.remove("play")},250)}})};!function(){"host"===window.localStorage.getItem("type")?(console.log("SETTING UP HOST"),MQTT_CLIENT_ID="DEMO_OUT",setupHostView()):(MQTT_CLIENT_ID="DEMO_IN",setupClientView())}();