"use strict";var MQTT_CLIENT_ID=null;!function(){var e=!1;void 0!==Paho.MQTT?e=!0:console.error("Be sure to include https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js");var n=null,i=!1,t=document.getElementById("connMsg");window.mqttConnect=function(){e&&((n=new Paho.MQTT.Client("wss://mqtt.thesis.dougs.website/ws",MQTT_CLIENT_ID)).onMessageArrived=o,n.connect({password:"AUTH_KEY",onSuccess:function(){console.log("CONNECTED"),n.subscribe("flowPub/"+MQTT_CLIENT_ID),i=!0,document.getElementById("connect-button").hidden=!0,t.innerText="Connected"}}))};var o=function(e){console.log(e.destinationName+" : "+e.payloadString);var t=JSON.parse(e.payloadString);playDrum(t.play)};window.logSensorData=function(e,t){if(i){var o={value:e,dataType:t,timestamp:(new Date).getTime(),sensorId:MQTT_CLIENT_ID};n.send("log",JSON.stringify(o),1)}}}();var setupHostView=function(){var e=document.querySelectorAll(".drum");document.getElementById("host").style.display="block";var n={snare:{audio:new Audio("./sounds/snare.opus"),timer:null,played:!1},crash:{audio:new Audio("./sounds/crash.opus"),timer:null,played:!1},hihatO:{audio:new Audio("./sounds/hihatO.opus"),timer:null,played:!1},hihatC:{audio:new Audio("./sounds/hihatC.opus"),timer:null,played:!1},kick:{audio:new Audio("./sounds/kick.opus"),timer:null,played:!1},lowtom:{audio:new Audio("./sounds/lowtom.opus"),timer:null,played:!1},medtom:{audio:new Audio("./sounds/medtom.opus"),timer:null,played:!1},hitom:{audio:new Audio("./sounds/hitom.opus"),timer:null,played:!1}};function o(e){var t=document.getElementById(e);if(t){var o=n[e];o.played||(o.played=!0,t.style.transitionDuration=o.audio.duration/3+"s"),o.audio.paused?o.audio.play():o.audio.currentTime=0,t.classList.add("play"),clearTimeout(o.timer),o.timer=setTimeout(function(){t.classList.remove("play")},1e3*o.audio.duration)}}e.forEach(function(t){t.addEventListener("click",function(e){e.preventDefault(),o(t.id)})}),window.playDrum=o},setupClientView=function(){document.getElementById("client").style.display="flex";var o=!0;mqttConnect();var n=document.getElementById("client-select"),e=n.getElementsByTagName("option");n.selectedIndex=Math.floor(Math.random()*e.length);var i=document.getElementById("countdown");document.getElementById("client-play").addEventListener("click",function(e){if(e.preventDefault(),o){var t=n.value;logSensorData(t,"string"),o=!1,i.classList.add("play"),setTimeout(function(){o=!0},750),setTimeout(function(){i.classList.remove("play")},250)}})};function setHost(){window.localStorage.setItem("type","host")}"host"===window.localStorage.getItem("type")?(console.log("SETTING UP HOST"),MQTT_CLIENT_ID="DEMO_OUT",setupHostView()):(MQTT_CLIENT_ID="DEMO_IN",setupClientView());